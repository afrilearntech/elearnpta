import { apiRequest, ApiClientError } from './client';

export interface TeacherRecord {
  id: number;
  teacher_id: string | null;
  profile: {
    id: number;
    email: string;
    phone: string;
    name: string;
    role: string;
    dob: string | null;
    gender: string | null;
    is_active: boolean;
    is_staff: boolean;
    is_superuser: boolean;
    phone_verified: boolean;
    email_verified: boolean;
    created_at: string;
    updated_at: string;
  };
  school: number;
  status: string;
  moderation_comment: string;
  created_at: string;
  updated_at: string;
}

export interface TeacherSubject {
  id: number;
  name: string;
  grade: string;
  status: string;
  description: string;
  thumbnail: string;
  teachers: number[];
  moderation_comment: string;
  objectives: string[];
  created_at: string;
  updated_at: string;
  created_by: number;
  teacher_count: number;
}

export interface TeacherDashboard {
  summarycards: {
    total_students: number;
    class_average: number;
    pending_review: number;
    completion_rate: number;
  };
  top_performers: {
    student_name: string;
    student_id: string;
    percentage: number;
    improvement: number;
  }[];
  pending_submissions: {
    student_name: string;
    student_id: string;
    assessment_title: string;
    subject: string;
    due_at: string;
    submitted_at: string;
  }[];
  upcoming_deadlines: {
    assessment_title: string;
    subject: string;
    submissions_done: number;
    submissions_expected: number;
    completion_percentage: number;
    due_at: string;
    days_left: number;
  }[];
}

export async function getTeacherDashboard(): Promise<TeacherDashboard> {
  return await apiRequest<TeacherDashboard>('/api-v1/teacher/dashboard/');
}

export async function getTeachers(): Promise<TeacherRecord[]> {
  return await apiRequest<TeacherRecord[]>('/api-v1/content/teachers/');
}

export interface GeneralAssessment {
  id: number;
  title: string;
  type: "QUIZ" | "ASSIGNMENT";
  given_by: number;
  instructions: string;
  marks: number;
  due_at: string;
  grade: string;
  status: string;
  moderation_comment: string;
  created_at: string;
  updated_at: string;
}

export interface CreateGeneralAssessmentRequest {
  title: string;
  type: "QUIZ" | "ASSIGNMENT";
  given_by?: number; // Optional - backend infers from token
  instructions: string;
  marks: number;
  due_at: string;
  grade: string;
  status: string;
  moderation_comment?: string;
}

export interface CreateGeneralAssessmentResponse {
  id: number;
  title: string;
  type: "QUIZ" | "ASSIGNMENT";
  given_by: number;
  instructions: string;
  marks: number;
  due_at: string;
  grade: string;
  status: string;
  moderation_comment: string;
  created_at: string;
  updated_at: string;
}

export async function getGeneralAssessments(): Promise<GeneralAssessment[]> {
  return await apiRequest<GeneralAssessment[]>('/api-v1/teacher/general-assessments/');
}

export async function createGeneralAssessment(payload: CreateGeneralAssessmentRequest): Promise<CreateGeneralAssessmentResponse> {
  // Don't send given_by - let the backend infer it from the authentication token
  const { given_by, ...requestPayload } = payload;
  
  return await apiRequest<CreateGeneralAssessmentResponse>('/api-v1/teacher/general-assessments/create/', {
    method: 'POST',
    body: JSON.stringify(requestPayload),
  });
}

export interface CreateTeacherRequest {
  name: string;
  phone: string;
  email: string;
  gender: string;
  dob: string;
  school_id: number;
}

export interface CreateTeacherResponse {
  id: number;
  teacher_id: string;
  profile: {
    id: number;
    email: string;
    phone: string;
    name: string;
    role: string;
    dob: string;
    gender: string;
    is_active: boolean;
    is_staff: boolean;
    is_superuser: boolean;
    phone_verified: boolean;
    email_verified: boolean;
    created_at: string;
    updated_at: string;
  };
  school: number;
  status: string;
  moderation_comment: string;
  created_at: string;
  updated_at: string;
}

export async function createTeacher(payload: CreateTeacherRequest): Promise<CreateTeacherResponse> {
  return await apiRequest<CreateTeacherResponse>('/api-v1/content/teachers/create/', {
    method: 'POST',
    body: JSON.stringify(payload),
  });
}

export interface BulkUploadTeacherResult {
  row?: number;
  status: string;
  teacher_id?: string | null;
  name?: string;
  phone?: string;
  errors?: Record<string, string[]>;
  [key: string]: any;
}

export interface BulkUploadTeacherResponse {
  summary: {
    total_rows: number;
    created: number;
    failed: number;
  };
  results: BulkUploadTeacherResult[];
}

export async function downloadTeacherBulkTemplate(): Promise<Blob> {
  const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL;
  if (!API_BASE_URL) {
    throw new ApiClientError('API base URL is not configured', 0);
  }

  const token = typeof window !== 'undefined' ? localStorage.getItem('auth_token') : null;
  const url = `${API_BASE_URL}/api-v1/content/teachers/bulk-template/`;

  const response = await fetch(url, {
    method: 'GET',
    headers: {
      ...(token && { Authorization: `Token ${token}` }),
    },
  });

  if (!response.ok) {
    const contentType = response.headers.get('content-type');
    const isJson = contentType?.includes('application/json');
    const data = isJson ? await response.json() : await response.text();
    
    const errorMessage =
      isJson && data?.message
        ? data.message
        : isJson && data?.error
        ? data.error
        : isJson && data?.detail
        ? data.detail
        : `Request failed with status ${response.status}`;

    throw new ApiClientError(errorMessage, response.status);
  }

  return await response.blob();
}

export async function bulkCreateTeachers(file: File): Promise<BulkUploadTeacherResponse> {
  const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL;
  if (!API_BASE_URL) {
    throw new ApiClientError('API base URL is not configured', 0);
  }

  const formData = new FormData();
  formData.append('file', file);

  const token = typeof window !== 'undefined' ? localStorage.getItem('auth_token') : null;
  const url = `${API_BASE_URL}/api-v1/content/teachers/bulk-create/`;

  const response = await fetch(url, {
    method: 'POST',
    headers: {
      ...(token && { Authorization: `Token ${token}` }),
    },
    body: formData,
  });

  const contentType = response.headers.get('content-type');
  const isJson = contentType?.includes('application/json');
  const data = isJson ? await response.json() : await response.text();

  if (!response.ok) {
    const errorMessage =
      isJson && data?.message
        ? data.message
        : isJson && data?.error
        ? data.error
        : isJson && data?.detail
        ? data.detail
        : `Request failed with status ${response.status}`;

    const errors = isJson && data?.errors ? data.errors : undefined;
    throw new ApiClientError(errorMessage, response.status, errors);
  }

  return data as BulkUploadTeacherResponse;
}

export interface TeacherStudent {
  id: number;
  student_id: string | null;
  profile: {
    id: number;
    email: string;
    phone: string;
    name: string;
    role: string;
    dob: string | null;
    gender: string | null;
    is_active: boolean;
    is_staff: boolean;
    is_superuser: boolean;
    phone_verified: boolean;
    email_verified: boolean;
    created_at: string;
    updated_at: string;
  };
  school: {
    id: number;
    name: string;
    district_id: number;
    district_name: string;
    county_id: number;
    county_name: string;
  };
  grade: string;
  status: string;
  moderation_comment: string;
  created_at: string;
  updated_at: string;
}

export async function getTeacherStudents(): Promise<TeacherStudent[]> {
  return await apiRequest<TeacherStudent[]>('/api-v1/teacher/students/');
}

export interface CreateStudentRequest {
  name: string;
  phone: string;
  email: string;
  grade: string;
  gender: string;
  dob: string;
  status?: string; // Optional, but we'll set it to "APPROVED" when teacher creates
}

export interface CreateStudentResponse {
  id: number;
  student_id: string;
  profile: {
    id: number;
    email: string;
    phone: string;
    name: string;
    role: string;
    dob: string | null;
    gender: string | null;
    is_active: boolean;
    is_staff: boolean;
    is_superuser: boolean;
    phone_verified: boolean;
    email_verified: boolean;
    created_at: string;
    updated_at: string;
  };
  school: {
    id: number;
    name: string;
    district_id: number;
    district_name: string;
    county_id: number;
    county_name: string;
  };
  grade: string;
  status: string;
  moderation_comment: string;
  created_at: string;
  updated_at: string;
}

export async function createTeacherStudent(payload: CreateStudentRequest): Promise<CreateStudentResponse> {
  const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL;
  if (!API_BASE_URL) {
    throw new ApiClientError('API base URL is not configured', 0);
  }

  const url = `${API_BASE_URL}/api-v1/teacher/students/create/`;
  const token = typeof window !== 'undefined' ? localStorage.getItem('auth_token') : null;

  console.log('Creating student with payload:', payload);
  console.log('URL:', url);
  console.log('Token present:', !!token);

  try {
    const response = await fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        ...(token && { Authorization: `Token ${token}` }),
      },
      body: JSON.stringify(payload),
    });

    console.log('Response status:', response.status);
    console.log('Response ok:', response.ok);

    const contentType = response.headers.get('content-type');
    const isJson = contentType?.includes('application/json');
    
    let data;
    try {
      data = isJson ? await response.json() : await response.text();
      console.log('Response data:', data);
    } catch (parseError) {
      console.error('Error parsing response:', parseError);
      throw new ApiClientError(
        `Server error (${response.status}): Unable to parse response`,
        response.status
      );
    }

    if (!response.ok) {
      const errorMessage =
        isJson && data?.message
          ? data.message
          : isJson && data?.error
          ? data.error
          : isJson && data?.detail
          ? data.detail
          : `Request failed with status ${response.status}`;

      const errors = isJson && data?.errors ? data.errors : undefined;
      
      console.error('API Error:', {
        status: response.status,
        message: errorMessage,
        errors: errors,
        fullResponse: data
      });
      
      throw new ApiClientError(errorMessage, response.status, errors);
    }

    return data as CreateStudentResponse;
  } catch (error) {
    console.error('Error in createTeacherStudent:', error);
    if (error instanceof ApiClientError) {
      throw error;
    }
    if (error instanceof TypeError && error.message === 'Failed to fetch') {
      throw new ApiClientError(
        'Network error: Unable to reach the server. Please check your connection and try again.',
        0
      );
    }
    throw new ApiClientError(
      error instanceof Error ? error.message : 'An unexpected error occurred',
      0
    );
  }
}

export interface BulkUploadResult {
  row?: number;
  status: string;
  student_db_id?: number;
  student_id?: string | null;
  name?: string;
  phone?: string;
  errors?: Record<string, string[]>;
  [key: string]: any;
}

export interface BulkUploadResponse {
  summary: {
    total_rows: number;
    created: number;
    failed: number;
  };
  results: BulkUploadResult[];
}

export async function downloadBulkTemplate(): Promise<Blob> {
  const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL;
  if (!API_BASE_URL) {
    throw new ApiClientError('API base URL is not configured', 0);
  }

  const token = typeof window !== 'undefined' ? localStorage.getItem('auth_token') : null;
  const url = `${API_BASE_URL}/api-v1/teacher/students/bulk-template/`;

  const response = await fetch(url, {
    method: 'GET',
    headers: {
      ...(token && { Authorization: `Token ${token}` }),
    },
  });

  if (!response.ok) {
    const contentType = response.headers.get('content-type');
    const isJson = contentType?.includes('application/json');
    const data = isJson ? await response.json() : await response.text();
    
    const errorMessage =
      isJson && data?.message
        ? data.message
        : isJson && data?.error
        ? data.error
        : isJson && data?.detail
        ? data.detail
        : `Request failed with status ${response.status}`;

    throw new ApiClientError(errorMessage, response.status);
  }

  return await response.blob();
}

export async function bulkCreateStudents(file: File): Promise<BulkUploadResponse> {
  const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL;
  if (!API_BASE_URL) {
    throw new ApiClientError('API base URL is not configured', 0);
  }

  const formData = new FormData();
  formData.append('file', file);

  const token = typeof window !== 'undefined' ? localStorage.getItem('auth_token') : null;
  const url = `${API_BASE_URL}/api-v1/teacher/students/bulk-create/`;

  const response = await fetch(url, {
    method: 'POST',
    headers: {
      ...(token && { Authorization: `Token ${token}` }),
    },
    body: formData,
  });

  const contentType = response.headers.get('content-type');
  const isJson = contentType?.includes('application/json');
  const data = isJson ? await response.json() : await response.text();

  if (!response.ok) {
    const errorMessage =
      isJson && data?.message
        ? data.message
        : isJson && data?.error
        ? data.error
        : isJson && data?.detail
        ? data.detail
        : `Request failed with status ${response.status}`;

    const errors = isJson && data?.errors ? data.errors : undefined;
    throw new ApiClientError(errorMessage, response.status, errors);
  }

  return data as BulkUploadResponse;
}

export interface TeacherGrades {
  summary: {
    total_grades: number;
    excellent: number;
    good: number;
    needs_improvement: number;
  };
  grades: {
    student_name: string;
    student_id: string;
    subject: string;
    grade_letter: string;
    percentage: number;
    status: string;
    updated_at: string;
  }[];
}

export async function getTeacherGrades(): Promise<TeacherGrades> {
  return await apiRequest<TeacherGrades>('/api-v1/teacher/grades/');
}

export interface TeacherSubmissions {
  submissions: {
    child_name: string;
    assessment_title: string;
    subject: string | null;
    score: number | null;
    assessment_score: number;
    submission_status: string;
    solution: {
      solution: string;
      attachment: string | null;
    };
    date_submitted: string;
  }[];
  summary: {
    graded: number;
    pending: number;
  };
}

export async function getTeacherSubmissions(): Promise<TeacherSubmissions> {
  return await apiRequest<TeacherSubmissions>('/api-v1/teacher/submissions/');
}

export interface TeacherTopic {
  id: number;
  subject: number;
  subject_name: string;
  name: string;
  created_at: string;
  updated_at: string;
}

export async function getTeacherTopics(): Promise<TeacherTopic[]> {
  return await apiRequest<TeacherTopic[]>('/api-v1/teacher/topics/');
}

export async function getTeacherSubjects(): Promise<TeacherSubject[]> {
  return await apiRequest<TeacherSubject[]>('/api-v1/teacher/subjects/');
}

export interface TeacherLesson {
  id: number;
  subject: number;
  topic: number;
  period: number;
  title: string;
  description: string;
  type: string;
  status: string;
  resource: string;
  thumbnail: string;
  created_by: number;
  moderation_comment: string;
  duration_minutes: number;
  created_at: string;
  updated_at: string;
}

export async function getTeacherLessons(): Promise<TeacherLesson[]> {
  return await apiRequest<TeacherLesson[]>('/api-v1/teacher/lessons/');
}

export interface TeacherLessonAssessment {
  id: number;
  lesson: number;
  type: "QUIZ" | "ASSIGNMENT";
  given_by: number;
  title: string;
  instructions: string;
  marks: number;
  due_at: string;
  status: string;
  moderation_comment: string;
  created_at: string;
  updated_at: string;
}

export async function getTeacherLessonAssessments(): Promise<TeacherLessonAssessment[]> {
  return await apiRequest<TeacherLessonAssessment[]>('/api-v1/teacher/lesson-assessments/');
}

export interface CreateLessonAssessmentRequest {
  lesson: number;
  type: "QUIZ" | "ASSIGNMENT";
  given_by?: number;
  title: string;
  instructions: string;
  marks: number;
  due_at: string;
  status: string;
  moderation_comment?: string;
}

export interface CreateLessonAssessmentResponse {
  id: number;
  lesson: number;
  type: "QUIZ" | "ASSIGNMENT";
  given_by: number;
  title: string;
  instructions: string;
  marks: number;
  due_at: string;
  status: string;
  moderation_comment: string;
  created_at: string;
  updated_at: string;
}

export async function createLessonAssessment(payload: CreateLessonAssessmentRequest): Promise<CreateLessonAssessmentResponse> {
  return await apiRequest<CreateLessonAssessmentResponse>('/api-v1/teacher/lesson-assessments/create/', {
    method: 'POST',
    body: JSON.stringify(payload),
  });
}

export interface CreateLessonRequest {
  subject: number;
  topic: number;
  period: number;
  title: string;
  description: string;
  type: string;
  status: string;
  resource?: File | string | null;
  thumbnail?: File | string | null;
  moderation_comment?: string | null;
  duration_minutes: number;
}

export interface CreateLessonResponse {
  id: number;
  subject: number;
  topic: number;
  period: number;
  title: string;
  description: string;
  type: string;
  status: string;
  resource: string;
  thumbnail: string;
  created_by: number;
  moderation_comment: string;
  duration_minutes: number;
  created_at: string;
  updated_at: string;
}

export async function createTeacherLesson(payload: CreateLessonRequest): Promise<CreateLessonResponse> {
  const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL;
  if (!API_BASE_URL) {
    throw new Error('API base URL is not configured');
  }

  const requiresFormData = payload.resource instanceof File || payload.thumbnail instanceof File;
  
  if (requiresFormData) {
    const formData = new FormData();
    formData.append("subject", payload.subject.toString());
    formData.append("topic", payload.topic.toString());
    formData.append("period", payload.period.toString());
    formData.append("title", payload.title);
    formData.append("description", payload.description);
    formData.append("type", payload.type);
    formData.append("status", payload.status);
    formData.append("duration_minutes", payload.duration_minutes.toString());
    if (payload.moderation_comment !== undefined && payload.moderation_comment !== null) {
      formData.append("moderation_comment", payload.moderation_comment);
    }
    if (payload.resource instanceof File) {
      formData.append("resource", payload.resource);
    } else if (typeof payload.resource === "string") {
      formData.append("resource", payload.resource);
    }
    if (payload.thumbnail instanceof File) {
      formData.append("thumbnail", payload.thumbnail);
    } else if (typeof payload.thumbnail === "string") {
      formData.append("thumbnail", payload.thumbnail);
    }

    const token = typeof window !== 'undefined' ? localStorage.getItem('auth_token') : null;
    const response = await fetch(`${API_BASE_URL}/api-v1/teacher/lessons/create/`, {
      method: 'POST',
      headers: {
        ...(token && { Authorization: `Token ${token}` }),
      },
      body: formData,
    });

    const contentType = response.headers.get('content-type');
    const isJson = contentType?.includes('application/json');
    const data = isJson ? await response.json() : await response.text();

    if (!response.ok) {
      const errorMessage =
        isJson && data?.message
          ? data.message
          : isJson && data?.error
            ? data.error
            : isJson && data?.detail
              ? data.detail
              : `Request failed with status ${response.status}`;
      throw new Error(errorMessage);
    }

    return data as CreateLessonResponse;
  }

  return await apiRequest<CreateLessonResponse>('/api-v1/teacher/lessons/create/', {
    method: 'POST',
    body: JSON.stringify(payload),
  });
}

export interface SubjectOption {
  id: number;
  name: string;
  grade: string;
}

export interface TopicOption {
  id: number;
  name: string;
  subject: number;
  created_at: string;
  updated_at: string;
}

// Use the same endpoints as content creators
export async function getSubjectsForSelect(): Promise<SubjectOption[]> {
  const subjects = await apiRequest<any[]>('/api-v1/content/subjects/');
  return subjects.map((s) => ({
    id: s.id,
    name: s.name,
    grade: s.grade,
  }));
}

export async function getTopicsForSubject(subjectId: number): Promise<TopicOption[]> {
  if (!subjectId) {
    return [];
  }
  // Use the same endpoint as content creators: /api-v1/topics/?subject=${subjectId}
  return await apiRequest<TopicOption[]>(`/api-v1/topics/?subject=${subjectId}`);
}

export interface CreateSubjectRequest {
  name: string;
  grade: string;
  status: string;
  description: string;
  thumbnail?: File | string | null;
  moderation_comment?: string | null;
  objectives: string;
}

export interface CreateSubjectResponse {
  id: number;
  name: string;
  grade: string;
  status: string;
  description: string;
  thumbnail: string;
  teachers: number[];
  moderation_comment: string;
  objectives: string[];
  created_at: string;
  updated_at: string;
  created_by: number;
  teacher_count: number;
}

export async function createTeacherSubject(payload: CreateSubjectRequest): Promise<CreateSubjectResponse> {
  const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL;
  if (!API_BASE_URL) {
    throw new Error('API base URL is not configured');
  }

  const url = `${API_BASE_URL}/api-v1/content/subjects/`;

  if (payload.thumbnail instanceof File) {
    const formData = new FormData();
    formData.append('name', payload.name);
    formData.append('grade', payload.grade);
    formData.append('status', payload.status);
    formData.append('description', payload.description);
    formData.append('thumbnail', payload.thumbnail);
    formData.append('objectives', payload.objectives);
    if (payload.moderation_comment) {
      formData.append('moderation_comment', payload.moderation_comment);
    }

    const token = typeof window !== 'undefined' ? localStorage.getItem('auth_token') : null;
    const response = await fetch(url, {
      method: 'POST',
      headers: {
        ...(token && { Authorization: `Token ${token}` }),
      },
      body: formData,
    });

    const contentType = response.headers.get('content-type');
    const isJson = contentType?.includes('application/json');
    const data = isJson ? await response.json() : await response.text();

    if (!response.ok) {
      const errorMessage =
        isJson && data?.message
          ? data.message
          : isJson && data?.error
            ? data.error
            : isJson && data?.detail
              ? data.detail
              : `Request failed with status ${response.status}`;
      throw new Error(errorMessage);
    }

    const responseData = Array.isArray(data) ? data[0] : data;
    return responseData as CreateSubjectResponse;
  } else {
    const response = await apiRequest<CreateSubjectResponse | CreateSubjectResponse[]>('/api-v1/content/subjects/', {
      method: 'POST',
      body: JSON.stringify(payload),
    });
    return Array.isArray(response) ? response[0] : response;
  }
}

export interface QuestionOption {
  id: number;
  question: number;
  value: string;
  created_at: string;
  updated_at: string;
}

export interface Question {
  id: number;
  general_assessment: number | null;
  lesson_assessment: number | null;
  type: "MULTIPLE_CHOICE" | "TRUE_FALSE" | "SHORT_ANSWER" | "ESSAY" | "FILL_IN_THE_BLANK";
  question: string;
  answer: string;
  options: QuestionOption[];
  created_at: string;
  updated_at: string;
}

export interface CreateQuestionRequest {
  general_assessment_id?: number;
  lesson_assessment_id?: number;
  type: "MULTIPLE_CHOICE" | "TRUE_FALSE" | "SHORT_ANSWER" | "ESSAY" | "FILL_IN_THE_BLANK";
  question: string;
  answer: string;
  options?: string[];
}

export interface CreateQuestionResponse {
  general_assessment_id?: number;
  lesson_assessment_id?: number;
  type: "MULTIPLE_CHOICE" | "TRUE_FALSE" | "SHORT_ANSWER" | "ESSAY" | "FILL_IN_THE_BLANK";
  question: string;
  answer: string;
  options: string[];
}

export async function getQuestions(params?: {
  general_assessment_id?: number;
  lesson_assessment_id?: number;
}): Promise<Question[]> {
  const queryParams = new URLSearchParams();
  if (params?.general_assessment_id) {
    queryParams.append('general_assessment_id', params.general_assessment_id.toString());
  }
  if (params?.lesson_assessment_id) {
    queryParams.append('lesson_assessment_id', params.lesson_assessment_id.toString());
  }

  const endpoint = `/api-v1/teacher/questions/${queryParams.toString() ? `?${queryParams.toString()}` : ''}`;
  return await apiRequest<Question[]>(endpoint);
}

export async function createQuestion(payload: CreateQuestionRequest): Promise<CreateQuestionResponse> {
  return await apiRequest<CreateQuestionResponse>('/api-v1/teacher/questions/create/', {
    method: 'POST',
    body: JSON.stringify(payload),
  });
}

export interface GradeGeneralAssessmentRequest {
  assessment_id: number;
  student_id: number;
  score: number;
}

export interface GradeGeneralAssessmentResponse {
  assessment_id: number;
  student_id: number;
  score: number;
}

export interface GradeLessonAssessmentRequest {
  assessment_id: number;
  student_id: number;
  score: number;
}

export interface GradeLessonAssessmentResponse {
  assessment_id: number;
  student_id: number;
  score: number;
}

export async function gradeGeneralAssessment(payload: GradeGeneralAssessmentRequest): Promise<GradeGeneralAssessmentResponse> {
  return await apiRequest<GradeGeneralAssessmentResponse>('/api-v1/teacher/grade/general/', {
    method: 'POST',
    body: JSON.stringify(payload),
  });
}

export async function gradeLessonAssessment(payload: GradeLessonAssessmentRequest): Promise<GradeLessonAssessmentResponse> {
  return await apiRequest<GradeLessonAssessmentResponse>('/api-v1/teacher/grade/lesson/', {
    method: 'POST',
    body: JSON.stringify(payload),
  });
}

export type ModerationModel = "subject" | "lesson" | "general_assessment" | "lesson_assessment" | "game" | "school" | "county" | "district" | "student" | "teacher";
export type ModerationAction = "approve" | "reject" | "request_changes" | "request_review";

export interface ModerateRequest {
  model: ModerationModel;
  id: number;
  action: ModerationAction;
  moderation_comment?: string;
}

export interface ModerateResponse {
  id: number;
  model: string;
  status: string;
  moderation_comment: string;
}

export async function moderateContent(payload: ModerateRequest): Promise<ModerateResponse> {
  return await apiRequest<ModerateResponse>('/api-v1/content/moderate/', {
    method: 'POST',
    body: JSON.stringify(payload),
  });
}

export async function approveStudent(studentId: number): Promise<TeacherStudent> {
  return await apiRequest<TeacherStudent>(`/api-v1/teacher/${studentId}/approve-student/`, {
    method: 'POST',
  });
}

export async function rejectStudent(studentId: number): Promise<TeacherStudent> {
  return await apiRequest<TeacherStudent>(`/api-v1/teacher/${studentId}/reject-student/`, {
    method: 'POST',
  });
}

